@{
    ViewData["Title"] = "So·∫°n th·∫£o Ghi ch√∫";
    // Layout = "_Layout"; 
}

<div class="main-content">
    <form id="noteForm" asp-controller="Notes" asp-action="SaveNote" method="post">
        <div class="page-header">
            <div class="header-top">
                <h1 class="page-title"><span>üìù</span> Ghi ch√∫</h1>
                <div class="header-actions">
                    <button type="button" class="btn btn-secondary" onclick="SecureNotes.saveNote()">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                        </svg> L∆∞u
                    </button>
                    
                    <a href="@Url.Action("Editor", "Notes")" class="btn btn-primary">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg> Ghi ch√∫ m·ªõi
                    </a>
                </div>
            </div>
        </div>

        <div class="editor-container shadow-sm bg-white rounded-3 border">
            <div class="editor-toolbar">
                <div class="toolbar-group">
                    <button type="button" class="toolbar-btn" data-command="bold" title="Bold (Ctrl+B)">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"/></svg>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="italic" title="Italic (Ctrl+I)">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z" /></svg>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="underline" title="Underline (Ctrl+U)">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/></svg>
                    </button>
                </div>

                <div class="toolbar-divider"></div>

                <div class="toolbar-group">
                    <button type="button" class="toolbar-btn" data-command="justifyLeft" title="Align Left">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z"/></svg>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="justifyCenter" title="Align Center">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M7 15v2h10v-2H7zm-4 6h18v-2H3v2zm0-8h18v-2H3v2zm4-6v2h10V7H7zM3 3v2h18V3H3z"/></svg>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="justifyRight" title="Align Right">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M3 21h18v-2H3v2zm6-4h12v-2H9v2zm-6-4h18v-2H3v2zm6-4h12V7H9v2zM3 3v2h18V3H3z"/></svg>
                    </button>
                </div>

                <div class="toolbar-divider"></div>

                <div class="toolbar-group">
                    <button type="button" class="toolbar-btn" data-command="insertUnorderedList" title="Bullet List">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/></svg>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="insertOrderedList" title="Numbered List">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/></svg>
                    </button>
                </div>

                <div class="toolbar-divider"></div>

                <div class="toolbar-group">
                    <button type="button" class="toolbar-btn" id="imageUpload" title="Insert Image">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                    </button>
                    <button type="button" class="toolbar-btn" id="tableInsert" title="Insert Table">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M10 10.02h5V21h-5zM17 21h3c1.1 0 2-.9 2-2v-9h-5v11zm3-18H5c-1.1 0-2 .9-2 2v3h19V5c0-1.1-.9-2-2-2zM3 19c0 1.1.9 2 2 2h3V10.02H3V19z"/></svg>
                    </button>
                </div>

                <div class="toolbar-divider"></div>

                <div class="toolbar-group" style="flex-grow: 1;">
                    <input type="text" name="Title" class="note-title-input" placeholder="Ti√™u ƒë·ªÅ ghi ch√∫..." value="Join Tables" required />
                </div>
            </div>

            <div class="editor-content" id="noteEditor" contenteditable="true">
                <h2>·∫¢nh 1</h2>
                
                <div class="editor-images" contenteditable="false">
                    <div class="editor-image-wrapper">
                        <button type="button" class="image-remove-btn" onclick="this.parentElement.remove()" title="X√≥a ·∫£nh">√ó</button>
                        <img src="https://images.unsplash.com/photo-1518531933037-91b2f5f229cc?w=400" alt="Heart tree" />
                    </div>
                    
                    <div class="editor-image-wrapper">
                        <button type="button" class="image-remove-btn" onclick="this.parentElement.remove()" title="X√≥a ·∫£nh">√ó</button>
                        <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400" alt="Forest" />
                    </div>
                    
                    <div class="editor-image-placeholder">
                        <button type="button" class="add-image-btn" onclick="alert('Ch·ª©c nƒÉng t·∫£i ·∫£nh l√™n s·∫Ω ƒë∆∞·ª£c l√†m sau!')">+ Th√™m</button>
                    </div>
                </div>

                <h3>B·∫£ng so s√°nh</h3>
                <table class="editor-table">
                    <thead>
                        <tr>
                            <th>Select 1</th>
                            <th>Select 2</th>
                            <th>Select 3</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Select</td>
                            <td>From 3</td>
                            <td>Where</td>
                        </tr>
                    </tbody>
                </table>

                <p><br /></p>
                <p>B·∫Øt ƒë·∫ßu vi·∫øt ghi ch√∫ c·ªßa b·∫°n t·∫°i ƒë√¢y...</p>
            </div>

            <div class="editor-footer">
                <div class="editor-status">
                    <span class="status-text">ƒê√£ l∆∞u t·ª± ƒë·ªông</span>
                    <span class="status-time">2 ph√∫t tr∆∞·ªõc</span>
                </div>
                <div class="editor-actions">
                    <button type="button" class="btn btn-secondary btn-sm d-flex align-items-center gap-1">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                        </svg>
                        Ch·ªânh s·ª≠a
                    </button>
                    
                    <button type="button" class="btn btn-primary btn-sm d-flex align-items-center gap-1" onclick="SecureNotes.saveNote()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        L∆∞u
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        // B·∫Øt s·ª± ki·ªán click v√†o c√°c n√∫t tr√™n Toolbar (In ƒë·∫≠m, in nghi√™ng, cƒÉn gi·ªØa...)
        document.querySelectorAll('.toolbar-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                // NgƒÉn n√∫t submit form
                e.preventDefault(); 
                
                // L·∫•y l·ªánh t·ª´ data-command (VD: 'bold', 'italic')
                const command = this.getAttribute('data-command');
                
                // K√≠ch ho·∫°t l·ªánh format c·ªßa tr√¨nh duy·ªát
                document.execCommand(command, false, null);
                
                // Focus l·∫°i v√†o √¥ editor ƒë·ªÉ g√µ ti·∫øp
                document.getElementById('noteEditor').focus();
            });
        });

        // Object ch·ª©a c√°c h√†m ch·ª©c nƒÉng x·ª≠ l√Ω Notes
        const SecureNotes = {
            saveNote: function() {
                // 1. L·∫•y to√†n b·ªô m√£ HTML m√† ng∆∞·ªùi d√πng v·ª´a g√µ trong khung Editor
                const editorHtml = document.getElementById('noteEditor').innerHTML;
                
                // 2. Nh√©t n√≥ v√†o th·∫ª <input type="hidden"> ƒë·ªÉ chu·∫©n b·ªã submit
                document.getElementById('hiddenContent').value = editorHtml;
                
                // 3. (T√πy ch·ªçn) M√£ h√≥a HTML t·∫°i ƒë√¢y n·∫øu mu·ªën b·∫£o m·∫≠t tr∆∞·ªõc khi g·ª≠i
                // document.getElementById('hiddenContent').value = btoa(editorHtml);

                // 4. G·ª≠i Form l√™n Server
                document.getElementById('noteForm').submit();
            }
        };
    </script>
}